# 퍼사드 패턴(Facade 패턴)
🚨주의점 : 이글은 퍼사드 패턴을 설명하는 글이 아닙니다.   
패턴에대한 저의 감상과 특정하게 강조해야하는 부분을 정리한 주석문이라고 보시면 좋습니다.  
-> 공부는 참고자료로 직접하세요

학습계기: SRP 원칙을 살펴보다 클린아키텍쳐 책에서 SRP를 지키지 못하는 설계 구조에서 해결하는 방법으로 가장 흔하게 사용되는 패턴이라 명시되어 학습하게 되었다.

전반적인 패턴에 대한 설명은 헤드퍼스트 디자인 패턴책과 guru 사이트를 통해서 학습하자  
-> 개인적으로 헤드퍼스트 책이 아주 읽기 쉽게 설명하며 부수적으로 최소 지식 원칙(데메테르의 법칙) 또한 살펴보게 되어서 좋았다.

## 패턴에 대한 풀이(개인적인 요소가 다분)

### 기억을 위한 이름 재정의(얼굴마담 패턴)
우선적으로 퍼사드라는 이름이 입에 착착 안붙는다.  
패턴은 그 패턴을 사용했다는것 만으로도 나의 의도를 드러낼 수 있고 또한 별다른 설명없이 다른 개발자와 소통이 가능하다는 점에서 강력한 요소로 작용한다고 생각한다.  
이에 이름을 꼭 기억하고 관련 클래스명에 명시해줘야한다고 생각한다.  

그래서 퍼사드 패턴을 어떻게 와닿게 기억해볼까 고심했다.  
퍼사드의 뜻은 다음과 같다.
> 파사드(Façade)는 ‘얼굴’을 의미하고 건축에서는 건물의 얼굴, 즉, 주요 외부 전면을 나타냅니다  

여기서 딱 떠오른게 얼굴마담이다.  
패턴의 의도 및 동작을 봐도 퍼사드 밑에 복잡한 것들을 숨기고(객체보다 큰단위인 서브시스템 단위로) 간단한 인터페이스를 제공하는 것이다.  
즉 못생긴 애들은 밑에서 조용히 일하고 클라이언트단에 얼굴마담을 세워서 클라이언트는 행복하게 만들어주는것과 같다고 생각한다.(차은우/카리나가 서빙하고 내가 열심히 접시닦고 요리하는것과 같음)

그래서 내가 기억하기 쉬운 용어로 **얼굴마담 패턴**이라고 외우고 다니려 한다.

### 개인적으로 설명하기 좋은 예시
이 패턴을 간단하게 설명하기 위해서 IOT 자동화를 들고싶다.  
IOT가 유행할때 "시리야 술마실꺼야"라고 핸드폰한테 외치면 내방 조명 다꺼지고 특정조명만 25%로 켜지면서 블루투스 스피커로 재즈가 나오는 간지나는 스마트홈을 조성해봤다.

이런 자동화를 하려면 아주 많은 요소들이 복합적으로 작용한다.  
전구1~7,식탁조명,TV,블루투스 스피커 이런것들이 복합적으로 상호작용해야 우아하게 시리한테 한방에 명령 할 수 있는것이다.(조명 각각이 프로그래밍 세계에서는 객체 -> 심지어 가상세계에서는 호출순서도 영향을 줄 수 있다.)

물론 이런 것들을 사용자가 하나하나 직접 실행할 수 있다.  
전구 1~7번 끄고, 식탁등 25%로 키고, TV끄고 뭐 등등 근데 이러면 귀찮기도 하고 순서가 있다면 더 귀찮고 복잡해지고 나중에는 순서같은건 기억조차 안날꺼다.  
심지어 이걸 엄마(다른 개발자)한테 켜달라고 부탁해보자 임무를 완수 못한채 엄마가 화나있을 가능성이 크다.  

이를 이제 자동화라는 툴(퍼사드)로 묶어서 한꺼번에 순서까지 조정해서 미리 설정해놓으면 그냥 "시리야 술마실꺼야" 하면 간지나는 스마트 홈으로 변경된다.  

이게 퍼사드의 예시라 생각한다.  
🤖결론: 복잡한 객체의 상호작용을 미리 정의해놓은 객체에 명시하여 사용자는 편리하게 사용하고 각 서브시스템과의 의존성을 낮출 수 있다.

자 여기까지가 줄 글로 든 예시고 이를 이제 각각 포인트를 간결하게 살펴보겠다.

- 서브시스템 단위의 객체지향이라 생각한다.  
  - 큰 설명이 필요없다고 생각한다. 물론 모든 은닉화 이런측면은 또 안맞긴한데 대략적인 결이 비슷하다.
- 퍼사드가 존재한다고 객체자체를 못다루는 은닉화가 아니다
  - 필요에 의해서(좀 더 많은 기능을 사용)로우레벨의 객체를 직접적으로 클라이언트가 다룰 수 있다.
  - IOT에서 자동화를 만들어놨다고 전구를 각각 켜고 끌수 있는것과 같다.(용도에 맞춰서 사용하자)
- 퍼사드는 여러개가 존재할 수 있다.
  - 퍼사드는 여러개를 만들수 있으며 필요에의해서 서브퍼사드를 만들 필요가 있다.
  - IOT에서 자동화를 꼭 하나만 만들어서 쓸필요는 없지않는가? 
  - 스마트홈에서 간지조명 기능만 가지면 웃기다. 영화보는 구성 키키 등등 뭐 많은 자동화가 생성될것이다.
- 퍼사드는 외부로부터 주입받아서 유연하게 만들필요는 없다고 생각한다.(개인적인 의견)
  - 이 부분은 자료마다 의견이 달라서 밑에서 다시 다뤄보려한다.
- 서브시스템(관련객체들이 모인 단위)와 소통하는 인터페이스를 제공 -> 계층화가 쉽다.
  - 이건 프로그래밍적으로 직관적으로 와닿을거라 생각한다.


### 자료마다 다른 부분 나의 의견 정리
위쪽에 "퍼사드는 외부로부터 주입받아서 유연하게 만들필요는 없다고 생각한다.(개인적인 의견)" 이부분이 자료마다 조금씩 달라서 나의 의견을 정리해보았다.

#### GOF의 디자인 패턴  
구현예제를 설명하는 부분에서 (262p 일부 발췌)
> 이 구현은 생성한 코드 생성자의 종류를 하드코딩했기 떄문에 프로그래머가 어떤 아키텍쳐를 목표로 하는지는 명시하지 않아도 됩니다. 이는 하나의 목표 아키텍처를 갖는다면 의미가 있지만 여러 아키텍처를 대상으로 한다면 Compiler 클래스의 생성자를 변경해야 합니다.즉 CodeGenerator를 매개변수로 받게끔 변경해야합니다.프로그래머는 compiler를 인스턴스화할 때 사용할 생성기(generator)가 무엇인지 알려줍니다. compiler는 다른 매개변수로 정의할 수 있는데 Scanner와 ProgramNodeBuilder를 매개변수로 정의하면 응용성이 늘어나게 됩니다. 그러나 이는 퍼사드 패턴의 임무를 없애는 것입니다. 퍼사드 패턴의 임무는 일반적인 사용을 위해 인터페이스를 간소화하는 것이기 떄문입니다.

이 부분을 풀어보자면 생성자로 내부에서 사용할 객체를 받아서 처리하는것이 코드 변동성에 대해 유연성은 올라가겠지만 이는 곧 서브 시스템의 클래스를 프로그래머가 알고있으며 인스턴스 생성 및 사용에 관여하는것 자체가 이미 서브클래스를 화이트 박스로 알고있다는 전제가 깔렸다는것과 같다.(이럴꺼면 그냥 객체 가져다 쓰지)

즉 쉽게 사용하려고 기껏 만들어놓은 퍼사드가 필요없어지는 상황이 벌어지는것이다.

#### 헤드퍼스트 디자인 패턴
구현예제를 설명하는 부분에서 (297p)  
퍼사드 객체를 생성할때 관련된 서브시스템의 객체를 전부 생성자를 통해 주입받아 사용하는 형태  
-> 즉 Gof 패턴에서 말하는 부분과 반대 (유연성 높이되 인터페이스의 편리함이 낮아짐)


#### 🐗나의 결론  
나는 이 두가지 관정에서 바라본다면 GOF 패턴이 맞다고 본다.  
IOT를 예시로 봤을떄 편할라고 자동화를 만들어놨는데 이 자동화에서 몇번전구가 어떻게 움직이는지 내가 관여하고 알아야하는것 부터가 비용이고 그럴꺼면 자동화 안쓴다.

그래서 이러한 인스턴스를 관리하는 룰 자체를 퍼사드 객체에서 들고있어야한다고 생각한다.
만약 유연성을 추구한다면 퍼사드 객체 자체를 추상화하여 쉽게 갈아끼우는 정도가 맞지않나 싶다.

사실 유연성이라는 단어가 너무 섹시한 단어이다.  
그냥 무조건 좋아보이는데 이런 경우를 보면 유연성이 만능은 아니라는 생각이 든다.


### 퍼사드 vs 어댑터
개인적으로 어댑터 패턴과 굉장히 유사하다는 인상을 최초에 강하게 받았다. 
하지만 어댑터 패턴과는 어느 정도의 차이가 있기도 하고 사실상 패턴은 그 이름에 의미가 있듯 사용용도의 차이라 생각한다. 

-  어댑터: 이미 정해져 있는 인터페이스에 외부코드를 밀어넣기위한 방법 (끼워넣기가 목표)
-  퍼사드: 서브 시스템 클래스들을 종합하는 얼굴마담을 앞에 세우는 방법 (단순화가 목표)
  
사실 패턴에서 하는 행위가 추상화랑 클래스 분리 이런거라 비슷해보이는게 많지만 결국 이름이 가지는 힘에서 다른 부분이 분명 존재한다고 생각한다.

이부분에 뭔가 부족하다면 헤드퍼스트 디자인 패턴책에 두 패턴을 비교해놓은 부분이있다.  
굉장히 쉽게 설명되어있어 이것을 참고해보자

## 장점 
1. 서브시스템의 구성요소를 보호할 수 있습니다.   
이를 통해 사용자가 다룰 객체가 줄어들며 이는 쉬운 사용으로 이어집니다.
2. 서브시스템과 사용자 코드간의 결합도를 약하게 만듭니다. 
3. 퍼사드를 사용하는게 필수는 아닙니다. 사용자에게 선택권을 줄 수 있습니다.
4. 계층화가 쉽고 계층간의 결합도를 낮출 수 있습니다.

## 사용을 고려해볼 시점(개인적인 생각)
1. 굉장히 복잡한 객체들을 구성해서 사용해야하는 상황(누군가에게 설명하기도 힘든 상황)
2. 다른 라이브러리나 다른 객체들의 상호작용을 한번더 단순화 시킬떄(우리 시스템에 맞춰서 단순화 시키기)
3. 뭔가 객체나 함수의 호출순서가 있어야하는 상황(물론 잘못 짰을 수 있지만 잘못 짰어도 사용해야할때가 있으니 보정방법으로) 퍼사드객체를 사용(퍼사드는 꼭 여러객체의 상호작용에만 적용하는것이 아닌 복잡한 단일 객체에도 적용가능)


## 참고자료
- [guru 사이트](https://refactoring.guru/ko/design-patterns/facade)
- Gof의 디자인 패턴 254p~264p
- 헤드퍼스트 디자인 패턴 290p~306p